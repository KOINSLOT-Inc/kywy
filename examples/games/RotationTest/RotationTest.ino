// SPDX-FileCopyrightText: 2023 - 2025 KOINSLOT, Inc.
// SPDX-License-Identifier: GPL-3.0-or-later

#include "Kywy.hpp"

Kywy::Engine engine;

const uint8_t spriteSheetData[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00,
  0x00, 0x03, 0xc0, 0x00, 0x00, 0x06, 0x60, 0x00, 0x00, 0x0c, 0x30, 0x00, 0x00, 0x18, 0x18, 0x00,
  0x00, 0x70, 0x0e, 0x00, 0x01, 0xc0, 0x03, 0x80, 0x07, 0x00, 0x00, 0xe0, 0x0c, 0x02, 0x40, 0x30,
  0x18, 0x0e, 0x70, 0x18, 0x10, 0x38, 0x1c, 0x08, 0x10, 0x00, 0x00, 0x08, 0x30, 0x00, 0x00, 0x0c,
  0x20, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x04,
  0x20, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x04, 0x30, 0x00, 0x00, 0x0c, 0x1f, 0xff, 0xff, 0xf8
};

const uint8_t *frames[] = { spriteSheetData };
Sprite slime(frames, 1, 32, 32);


class slimeRotator : public Actor::Actor {
public:
  int angle = 0;

  void initialize() {
    slime.setPosition(58, 64);
    slime.setVisible(true);
    slime.setNegative(true);
  }

  void handle(::Actor::Message *message) {


    switch (message->signal) {
      case Kywy::Events::TICK:
          engine.display.clear();
          slime.setRotation(angle);
          // engine.display.drawText(KYWY_DISPLAY_WIDTH / 2, KYWY_DISPLAY_HEIGHT / 2, "Spinning!!", Display::TextOptions().origin(Display::Origin::Text::CENTER).rotation(angle));
          slime.render();
          angle += 1;
          if (angle >= 360)
            angle = 0;
          engine.display.update();
    }
  }
} slimeRotator;

void setup() {
  engine.start();
  slime.setDisplay(&engine.display);

  slimeRotator.subscribe(&engine.input);
  slimeRotator.subscribe(&engine.clock);
  slimeRotator.start();
}

void loop() {
  delay(1000);
}
